\chapter{积分理论}

\section{积分的存在性}

先放这，稍后做整理。

\begin{definition}
	设函数 $f$ 与 $F$ 在区间 $I$ 上都有定义。若
	\[ F'(x) = f(x), x\in I \]
	则称 $F$ 为 $f$ 在区间 $I$ 上的一个原函数。
\end{definition}

\begin{theorem}
	设 $F$ 是 $f$ 在区间 $I$ 上的一个原函数，则
	（1） $F+C$ 也是 $f$ 在 $I$ 上的原函数，其中 $C$ 为任意常量函数
	（2） $f$ 在 $I$ 上的任意两个原函数之间，只可能相差一个常数。
\end{theorem}
\begin{proof}
	（1） 显然
	\[ \left[ F(x)+C \right]' = F'(x) = f(x), x\in I \]

	（2） 设 $F$ 和 $G$ 是 $f$ 在 $I$ 上的任意两个原函数，则有
	\[ \left[ F(x)-G(x) \right]' = F'(x) - G'(x) = f(x) - f(x) = 0, x\in I \]
	根据 Lagrange 中值定理，有
	\[ F(x) - G(x) \equiv C, x\in I \]
\end{proof}

\begin{definition}
	函数 $f$ 在区间 $I$ 上的全体原函数称为 $f$ 在 $I$ 上的不定积分，记作
	\[ \int f(x) \d x = F(x) + C \]
\end{definition}

其中 $\displaystyle\int$ 称为积分号，$f(x)$ 为被积函数，$f(x)\d x$ 为被积表达式，$x$ 称为积分变量。

\subsection{定积分}

设闭区间 $[a,b]$ 上有 $n-1$ 个点，依次为
\[ a = x_0 < x_1 < \cdots < x_{n-1} < x_n = b \]
它们把 $[a,b]$ 分为 $n$ 个小区间 $\Delta_i = [x_{i-1},x_i], i=1,\cdots,n$。这些分点或这些闭子区间构成对 $[a,b]$ 的一个分割，记为
\[ T=\{x_0,\cdots,x_n\}\ \text{或}\ \{\seq{\Delta}{n}\} \]
小区间 $\Delta_i$ 的长度为 $\Delta x_i = x_i-x_{i-1}$，并记
\[ \| T \| = \max_{1 \leqslant i \leqslant n}\{\Delta x_i\} \]
称为分割的模。

\begin{definition}
	设 $f$ 是定义在 $[a,b]$ 上的一个函数。对于 $[a,b]$ 的一个分割 $T=\{\seq{\Delta}{n}\}$，任取点 $\xi\in\Delta_i,i=1,\cdots,n$，并作和式
	\[ \sum_{i=1}^nf(\xi_i)\Delta x_i \]
	称此和式为函数 $f$ 在 $[a,b]$ 上的一个积分和，也称黎曼和。
\end{definition}

显然，积分既与分割 $T$ 与有关，又与所选取的点集 $\{\xi_i\}$ 有关。

\begin{definition}
	设 $f$ 是定义在 $[a,b]$ 上的一个函数，$J$ 是一个确定的实数。若对任给的正数 $\epsilon$，总存在某一正数 $\delta$，使得对 $[a,b]$ 的任何分割 $T$，以及在其上任意选取的点集 $\{\xi_i\}$，只要 $\| T \| < \delta$，就有
	\[ \left| \sum_{i=1}^nf(\xi_i)\Delta x_i - J \right| < \eps \]
	则称函数 $f$ 在区间 $[a,b]$ 上可积或黎曼可积；数 $J$ 称为 $f$ 在 $[a,b]$ 上的定积分或黎曼积分，记作
	\[ J = \int_a^b f(x) \d x = \lim_{\| T \| \to 0} \sum_{i=1}^nf(\xi_i)\Delta x_i \]
\end{definition}

其中 $f$ 称为被积函数，$x$ 称为积分变量，$[a,b]$ 称为积分区间，$a,b$ 分别称为这个定积分的下限和上限。

\begin{theorem}[Newton - Leibniz 公式]
	若函数 $f$ 在 $[a,b]$ 上连续，且存在原函数 $F$，即 $F'(x) = f(x), x\in[a,b]$，则 $f$ 在 $[a,b]$ 上可积，且
	\[ \int_a^bf(x)\d x = F(b) - F(a) \]
\end{theorem}

\begin{proof}
	即证对于任给的 $\eps > 0$，存在 $\delta>0$ 使得当 $\| T \| < \delta$ 时有
	\[ \left| \sum_{i=1}^nf(\xi_i)\Delta x_i - [F(b)-F(a)] \right| < \eps \]
	对于任意分割 $T$，在每个小区间 $[x_{i-1},x_i]$ 上对 $F(x)$ 使用 Lagrange 中值定理，则分别存在 $\eta_i \in (x_{i-1},x_i),i=1,\cdots,n$，使得
	\[ F(b)-F(a) = \sum_{i=1}^n F'(\eta_i)\Delta x_i = \sum_{i=1}^nf(\eta_i)\Delta x_i \]
	又因为 $f$ 在 $[a,b]$ 上一致连续，因此存在 $\delta > 0$ 当 $x_1,x_2\in[a,b]$ 且 $|x_1-x_2| < \delta$ 时，有
	\[ f(x_1) - f(x_2)| < \frac{\eps}{b-a} \]
	由 $\Delta x_i \leqslant \| T \| < \delta$ 时，任取 $\xi_i \in [x_{i-1},x_i]$，便有 $|\xi_i-\eta_i|<\delta$，于是
	\[ LHS = \left| \sum_{i=1}^n [f(\xi_i)-f(\eta_i)]\Delta x_i \right| \leqslant \frac{\eps}{b-a}\sum_{i=1}^n\Delta x_i = \eps \]
	于是 $f$ 在 $[a,b]$ 上可积。
\end{proof}

\subsection{可积条件}

\begin{theorem}
	若函数 $f$ 在 $[a,b]$ 上可积，则 $f$ 在 $[a,b]$ 上必定有界。
\end{theorem}
\begin{proof}
	反证，若 $f$ 在 $[a,b]$ 上无界，则对于即对于 $[a,b]$ 的任意分割 $T$，必存在属于 $T$ 的某区间 $\Delta_k$，使 $f$ 在其上无界。在 $i\ne k$ 的各个区间 $\Delta_i$ 上取定 $\xi_i$，记
	\[ G = \left| \sum_{i\ne k}f(\xi)\Delta x_i \right| \]
	任意大的正数 $M$，存在 $\xi_k\in \Delta_k$，使得
	\[ |f(\xi_k)| > \frac{M+G}{\Delta x_k} \]
	于是有
	\[ \left| \sum_{i=1}^nf(\xi)\Delta x_i \right| \geqslant |f(\xi_k)\Delta x_k| - \left| \sum_{i\ne k}f(\xi)\Delta x_i \right| > \frac{M+G}{\Delta x_k}\cdot \Delta x_k - G = M \]
\end{proof}

有界函数不一定黎曼可积，比如 Dirichlet 函数。

设 $T$ 为对 $[a,b]$ 的任意分割。由 $f$ 在 $[a,b]$ 上有界，它在每个 $\Delta_i$ 上存在上、下确界：
\[ M_i=\sup_{x\in\Delta_i}f(x),m_i = \inf_{x=\Delta_i}f(x),i=1,\cdots,n \]
作和
\[ S(T) = \sum_{i=1}^nM_i\Delta x_i, s(T) = \sum_{i=1}^n m_i \Delta x_i \]
分别称为 $f$ 关于分割 $T$ 的上和与下和（或称达布上和与达布下和，统称达布和）。任给 $\xi_i = \Delta_i,i=1,\cdots,n$，显然有
\[ m(b-a) \leqslant s(T) \leqslant \sum_{i=1}^n f(\xi_i)\Delta x_i \leqslant S(T) \leqslant M(b-a) \]
与积分和相比较，达布和只与分割 $T$ 有关，而与点集 $\{\xi_i\}$ 无关。

\begin{proposition}
	给定分割 $T$，对于任何点集 $\{\xi_i\}$ 而言，上和时所有积分和的上确界，下和是所有积分和的下确界。
\end{proposition}
\begin{proof}
	设 $\Delta_i$ 中 $M_i$ 是 $f(x)$ 的上确界，故可选取点 $\xi=\Delta_i$，使 $f(\xi_i)>M_i-\frac{\eps}{b-a}$，于是有
	\[ \sum_{i=1}^nf(\xi_i)\Delta x_i > \sum_{i=1}^nM_i\Delta x_i-\frac{\eps}{b-a}\sum_{i=1}^n\Delta x_i = S(T)-\eps \]
	即 $S(T)$ 是全体积分和的上确界。类似可证 $s(T)$ 是全体积分和的下确界。
\end{proof}


\begin{proposition}
	设 $T'$ 为分割 $T$ 添加 $p$ 个新分点后所得到的分割，则有

\end{proposition}

\begin{theorem}
	函数 $f$ 在 $[a,b]$ 上可积的充要条件是：人格 $\eps >0$，总存在相应的一个分割 $T$ 使得
	\[ S(T) - s(T) < \sum_{i=1}^n\omega_i\Delta x_i = \eps \]
\end{theorem}

其中 $\omega$ 称为 $f$ 在 $\Delta_i$ 上的振幅。

由充要条件，我们可以得到一系列的可积函数类。

\begin{theorem}
	若 $f$ 为 $[a,b]$ 上的连续函数，则 $f$ 在 $[a,b]$ 上可积。
\end{theorem}
\begin{proof}
	由于 $f$ 在闭区间 $[a,b]$ 上一致连续，即任给 $\eps > 0$，存在 $\delta>0$，对 $[a,b]$ 中任意两点 $x_1,x_2$，只要 $|x_1-x_2|<\delta$，便有
	\[ |f(x_1)-f(x_2)| < \frac{\eps}{b-a} \]
	所以对于在 $[a,b]$ 的分割 $T$ 满足 $\|T\| < \delta$，在 $T$ 所属的任一小区间 $\Delta_i$ 上，都有
	\[ \omega_i = M_i-m_i = \sup_{x_1,x_2\in\Delta_i}|f(x_1)-f(x_2)| \leqslant \frac{\eps}{b-a} \]
	从而
	\[ \sum_{T}\omega_i\Delta x_i \leqslant \frac{\eps}{b-a}\sum_T\Delta x_i = \eps \]
\end{proof}



\section{不定积分}

这部分我的参考书是《积分的方法与技巧》（金玉明等）。

\subsection{分项积分法}

若干微分式的和或差的不定积分，等于每个微分式的各自积分的和或差。
\[ \int\left( f(x)+g(x)-h(x) \right)\d x = \int f(x)\d x + \int g(x)\d x - \int h(x)\d x \]
因此多项式的积分可以简单的通过积分各个单项式得到。

当分母可以被拆成低次式时，可以考虑使用分项积分法。

如果一个分式的分母为多项式，则可把它化成最简单的分式再积分。如
\[ \frac{1}{x^2-a^2} = \frac{1}{2a}\left( \frac{1}{x-a}-\frac{1}{x+a} \right) \]
这里可以通过通分后待定系数得到。于是其积分为
\[ \int \frac{\d x}{x^2-a^2} = \frac{1}{2a}\ln\left|\frac{x-a}{x+a}\right|+C \]
对于更复杂的真分式的情况，若要计算的是
\[ \int \frac{mx+n}{x^2+px+q} \d x \]
分母不一定能直接分解，但总能进行配方
\[ x^2+px+q = \left(x+\frac{p}{2}\right)^2+q-\frac{p^2}{4} = t^2 \pm a^2 \]
再令 $A=m,B=n-\frac12mp$，可得
\[ \int \frac{mx+n}{x^2+px+q} \d x = \int \frac{At+B}{t^2 \pm a^2} \d
	= A\int \frac{t\d t}{t^2 \pm a^2} + B\int \frac{\d t}{t^2 \pm a^2}\]
其中

\[
	\begin{aligned}
		A\int \frac{t \d t}{t^2 \pm a^2} & = \frac{A}{2}\int \frac{\d(t^2 \pm a^2)}{t^2 \pm a^2} = \frac{A}{2} \ln|t^2 \pm a^2| +C \\
		B\int \frac{\d t}{t^2 + a^2}     & = \frac{B}{a}\arctan\frac{t}{a}+C                                                       \\
		B\int \frac{t \d t}{t^2 - a^2}   & = \frac{B}{2a}\ln\left|\frac{t-a}{t+a}\right|+C
	\end{aligned}
\]

因此当 $p^2<4q$ 时，可以得到
\[
	\begin{aligned}
		\int \frac{mx+n}{x^2+px+q} & = \frac{A}{2} \ln|t^2 + a^2| + \frac{B}{a}\arctan\frac{t}{a} + C                               \\
		                           & =\frac{m}{2}\ln|x^2+px+q| + \frac{2n-mp}{\sqrt{4q-p^2}}\arctan{\frac{2x+p}{\sqrt{4q-p^2}}} + C
	\end{aligned}
\]

当 $p^2>4q$ 时，可以得到
\[
	\begin{aligned}
		\int \frac{mx+n}{x^2+px+q} & = \frac{A}{2} \ln|t^2 - a^2| + \frac{B}{2a}\ln\left|\frac{t-a}{t+a}\right|                                                  \\
		                           & =\frac{m}{2}\ln|x^2+px+q| + \frac{2n-mp}{2\sqrt{4q-p^2}}\ln\left| \frac{2x+p-\sqrt{p^2-4q}}{2x+p+\sqrt{p^2-4q}} \right| + C
	\end{aligned}
\]

\subsection{分部积分法}

根据乘积的微分法则
\[ \d(uv) = u \d v + v \d u \]
显然有
\[ \int u \d v = uv - \int v \d u \]

更进一步的，假设
\[ \begin{aligned}
		\int u v^{(n+1)} \d x & = \int u \d v^{(n)} = uv^{(n)} - \int u' v(n) \d x                                                                 \\
		                      & = u v^{(n)} - u^{(1)} v^{(n-1)} + u^{(2)} v^{(n-2)} + \cdots + (-1)^n u^{(n)} v + (-1)^{n+1} \int u^{(n+1)} \d v x
	\end{aligned} \]

例如当 $P(x)$ 是关于 $x$ 的多项式时，假设计算
\[ \int P(x) \ee^{ax} \d x = \ee^{ax} \left( \frac{P}{a} - \frac{P'}{a^2} + \frac{P''}{a^3} + cdots \right) \]
另一个形式是
\[ \int P(x) \sin ax \d x = \sin ax \left( \frac{P'}{a^2} - \frac{P^{(3)}}{a^4} + \cdots  \right) - \cos ax \left( \frac{P}{a} - \frac{P''}{a^3} + \cdots \right) \]
对于 $\cos ax$，类似的有
\[ \int P(x) \cos ax \d x = \sin ax \left( \frac{P'}{a^2} - \frac{P^{(3)}}{a^4} + \cdots  \right) + \cos ax \left( \frac{P}{a} - \frac{P''}{a^3} + \cdots \right) \]

这种一般答案比被积函数高一阶，试一试系数就行。有时候会两种形式交错，比如
\[ \int \ee^{ax} \sin bx \d x = \frac{\ee^{ax}}{a^2+b^2} (a \sin bx - b \cos bx) + C\]


\subsection{三角换元积分法}

这种题需要灵感并积累一些套路。

三角换元一般隐藏这一些直角三角形，建议草稿纸上画出来，分析的清楚一点。

\paragraph{形式一} 如果没有特殊形式，可以尝试齐次化（或者硬代万能公式），强行化有理式。

例如
\[ \int \frac{\d x}{a^2 \sin^2 x + b^2 \cos^2 x} \]
尝试 $\tan x = t$，有
\[ \d t = \frac{\d x}{\cos^2 x} = (1 + t^2) \d x \]
因此
\[ LHS = \int \frac{\d t}{a^2 t^2 + b^2} = \frac{1}{ab} \arctan \left( \frac{a}{b} \tan x \right) + C \]


假如计算
\[ \int \frac{\d x}{\sin 2x} = \int \frac{t^2+1}{2t} \d x = \frac{1}{2} \ln | \tan x| + C \]


\paragraph{形式二} 形如 $\sqrt{a^2 - x^2}$ 的积分，设 $x = a \sin \theta$，则
\[ \d x = a \cos \theta \d \theta, \quad \sqrt{a^2 - x^2} = a \cos \theta \]

例如
\[ \int \sqrt{a^2 - x^2} \d x = a^2 \int \cos^2 \theta \d \theta = \frac{x}{2}\sqrt{a^2 - x^2} + \frac{a^2}{2} \arcsin \frac{x}{a} + C \]

\paragraph{形式三} 形如 $\sqrt{a^2 + x^2}$ 的积分，设 $x = a \tan \theta$，则
\[ \d x = a \sec^2 \theta \d \theta, \quad \sqrt{a^2+x^2} = a \sec \theta \]

双元法是一类特殊的三角换元，来自虚调子\footnote{\href{https://zhuanlan.zhihu.com/p/443599480}{一小时学会双元教程！}}。其本质就是 $x\d x \pm y \d y = 0$ 更直观，在部分题中能够避免被根号绕进去。

\subsection{欧拉替换法}

对于二次根式 $\sqrt{a x^2 + b x + c}$。

\paragraph{形式一} 令
\[ \sqrt{a^2x^2+bx+c} = t - ax \]
两边平方可得
\[ x = \frac{t^2 - c}{2at + b}, \quad 2\frac{at^2 + bt + ca}{(2at+b)^2} \d t \]

\section{定积分的基本性质}

\subsection{中值定理}

\begin{theorem}[积分第一中值定理]
	设 $f$ 在 $[a,b]$ 上可积且连续，则存在 $\xi \in [a, b]$ 使得
	\[ \int_{a}^{b} f(x) \d x = f(\xi) (b-a) \]
\end{theorem}

\begin{proof}
	设 $m, M$ 分别是 $f$ 在 $[a,b]$ 上的最小值和最大值，显然存在 $\mu \in [m, M]$ 使得
	\[ m \leqslant \mu = \frac{1}{b-a}\int_{a}^{b} f(x) \d x \leqslant M \]
	由连续性显然存在 $f(\xi) = \mu$。
\end{proof}

\begin{theorem}[广义积分第一中值定理]
	假设 $f, g$ 在 $[a, b]$ 上可积且连续，在 $[a,b]$ 上恒有 $g \geqslant 0$ 或 $g \leqslant 0$，则存在 $\xi \in [a,b]$ 使得
	\[ \int_{a}^{b} f(x)g(x) \d x = f(\xi) \int_{a}^{b} g(x) \d x \]
\end{theorem}

\begin{proof}
	不妨令 $g \geqslant 0$。设 $m, M$ 为 $f$ 在 $[a, b]$ 上的最小值和最大值，如果
	\[ \int_{a}^{b} g(x) \d x \neq 0 \]
	则存在 $\mu \in [m, M]$ 使得
	\[ m \leqslant \mu = \frac{ \int_{a}^{b} f(x)g(x) \d x}{\int_{a}^{b} g(x) \d x} \leqslant M \]
	显然此时存在 $\xi = \mu$。假如积分为 $0$，则显然有 $g = 0$，任意 $\xi$ 都成立。
\end{proof}

\begin{theorem}[积分第二中值定理]
	假设 $f, g$ 在 $[a,b]$ 上可积，且 $g \geqslant 0$。如果 $g$ 单调递减，则存在 $\xi \in [a, b]$ 满足
	\[ \int_{a}^{b} f(x) g(x) \d x = g(a) \int_{a}^{\xi} f(x) \d x \]
	如果 $g$ 单调递增，则存在 $\eta \in [a, b]$ 满足
	\[ \int_{a}^{b} f(x) g(x) \d x = g(b) \int_{\eta}^{b} f(x) \d x \]
\end{theorem}

\subsection{变量替换法}

\begin{theorem}
	假设函数 $\varphi : [\alpha, \beta] \to [a, b]$ 连续可导，且 $\varphi(\alpha) = a, \varphi(\beta) = b$，则对任意的 $[a, b]$ 上的可积函数 $f$ 有 $f(\varphi(t))\varphi'(t)$ 可积，且
	\[ \int_{a}^{b} f(x) \d x = \int_{\alpha}^{\beta} f(\varphi(t)) \varphi'(t) \d t \]
	假如 $\varphi$ 严格单调，则有
	\[ \int_{\varphi(\alpha)}^{\varphi(\beta)} f(x) \d x = \int_{\alpha}^{\beta} f(\varphi(t)) \varphi'(t) \d t \]

\end{theorem}

\section{反常积分}

\begin{definition}
	假设函数 $f : [a, \infty) \to \mathbb{R}$ 可积。如果极限存在，则记
	\[ \int_{a}^{+\infty} f(x) \d x = \lim_{A \to +\infty} \int_{a}^{A} f(x) \d x \]
	称为 $f$ 在 $[a, +\infty)$ 上的无穷积分或第一类反常积分。
\end{definition}

类似的我们可以定义 $(-\infty, a]$ 上的无穷积分。考虑函数 $f : (-\infty, +\infty) \to \mathbb{R}$，若对任意的 $c$ 下面的积分都收敛，则记
\[ \int_{-\infty}^{+\infty} f(x) \d x = \int_{-\infty}^{c} f(x) \d x + \int_{c}^{+\infty}f(x) \d x \]
当然，只要存在 $c$ 使得收敛，将对全体 $\mathbb{R}$ 收敛。

一个常见的误区是认为
\[ \lim_{A \to +\infty} \int_{-A}^{A} f(x) \d x \]
收敛，则 $(-\infty, +\infty)$ 上的反常积分存在。反例是 $f = \sin x$。
