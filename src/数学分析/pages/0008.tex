\chapter{多变量理论}

\section{多变量极限}

我们回忆一下 $n$ 维 Euclidean 空间
\[ \mathbb{R}^n = \{\vbf{x} = (x_1, \cdots, x_n) \mid x_i \in \mathbb{R} \} \]
其中的元素我们记为 $n$ 维向量（vector）。在其上我们定义向量内积的概念
\[ \vbf{x} \cdot \vbf{y} = \langle \vbf{x}, \vbf{y} \rangle= \sum_{i=1}^{n} x_i y_i \]
向量内积具有线性性。并满足 Schwarz 不等式：
\[ (\vbf{x} \cdot \vbf{y})^2 \leqslant (\vbf{x} \cdot \vbf{x})(\vbf{y} \cdot \vbf{y}) \]

我们定义一个向量的范数（norm）为
\[ |\vbf{x}| = \sqrt{\vbf{x} \cdot \vbf{x}} = \sqrt{\sum_{i=1}^{n} |x_i|^2}  \]
从而有三角不等式
\[ |\vbf{x} + \vbf{y}| +\leqslant |\vbf{x}| + |\vbf{y}| \]
事实上还存在一些其他范数，比如 $p$ - 范数
\[ |\vbf{x}|_p = \sqrt[p]{\sum_{i=1}^{n} |x_i|^p}  \]
和 $\infty$ - 范数
\[ |\vbf{x}|_\infty = \max_{i=1}^{n} |x_i|  \]

可以进一步的定义向量的夹角
\[ \theta_{\vbf{x}, \vbf{y}} = \arccos\frac{\vbf{x} \cdot \vbf{y}}{|\vbf{x}||\vbf{y}|} \]
和距离
\[ d(\vbf{x}, \vbf{y}) = |\vbf{x}-\vbf{y}| \]
从而构建出度量空间。

我们可以定义球邻域
\[ \mathbb{B}^n(\vbf{x}, r) = \{ \vbf{y} \mid |\vbf{y}-\vbf{x}| < r \} \]
和方邻域
\[ \mathbb{O}^n(\vbf{a}, r) = \{ \vbf{x} \mid |x_i - a_i| < r, 1 \leqslant i \leqslant n \} \]
由于
\[ \mathbb{B}^n(\vbf{a}, r) \subset \mathbb{O}^n(\vbf{a}, r) \subset \mathbb{B}^n(\vbf{a}, r\sqrt{n})  \]
我们可以不加区分的统称为邻域，记作 $U(\vbf{a}, r)$。

\begin{definition}
	设 $\{\vbf{x}_i\}$ 是 $\mathbb{R}^n$ 中的点列。如果存在 $M > 0$ 使得 $\vbf{x}_i \in \mathbb{B}^n(\vbf{0}, M)$，则称其为有界的。如果对任意 $\eps > 0$ 都存在正整数 $I$ 使得当 $i > I$ 时满足
	\[ |\vbf{i} - \vbf{x}| < \eps \]
	成立，即 $\vbf{x} \in \mathbb{B}^n(\vbf{x}, \eps)$，则记
	\[ \lim_{i \to \infty} \vbf{x}_i = \vbf{x} \]
	假如不收敛到任何点，则称其为发散的。
\end{definition}

考虑到考研对多元部分的考察并不深入，将实数上的连续性搬到多元空间上是自然的，可以信赖直觉。

\begin{definition}
	设 $D \subset \mathbb{R}^n$，且 $\vbf{a} \in D'$ 是 $D$ 的聚点，如果对任意 $\eps > 0$ 存在 $\delta > 0$ 使得当 $\vbf{x} \in U^{\circ}(\vbf{a}, \delta) \cap D$ 有
	\[ |f(\vbf{x} - A)| < \eps \]
	成立，则称 $f(\vbf{x})$ 在 $D$ 上当 $\vbf{x} \to \vbf{a}$ 时以 $A$ 为极限，或者称为 $n$ 重极限，记作
	\[ \lim_{\vbf{x} \to \vbf{a}} f(\vbf{x}) = A \]
\end{definition}

实数上极限的唯一性、有界性等性质也可以搬过来。但是有一些复杂的情况，比如
\[ \lim_{(x, y) \to \vbf{0}} \frac{y}{x} \]
我们沿着 $y = kx$ 趋于 $\vbf{0}$，得到是 $k$ 不是定值，说明极限不存在。

\begin{definition}
	设 $D = D_1 \times D_2 \subset \mathbb{R}$，$x_0, y_0$ 分别是 $D_1, D_2$ 的聚点。如果对每个固定的 $y \in D_2$ 且 $y \neq y_0$ 作为 $x$ 的一元函数，极限
	\[ \lim_{x \to x_0} f(x, y) \]
	存在且极限
	\[ \lim_{y \to y_0} \lim_{x \to x_0} f(x, y) \]
	也存在，则称后者为 $f$ 在 $(x_0, y_0)$ 点先对 $x$ 后对 $y$ 的累次极限。
\end{definition}

\section{多变量导数}

回顾一下一元函数 $f(x)$ 在 $a$ 处的微分
\[ f(a + \Delta x) - f(a) = f'(a) \Delta x + o(|\Delta x|) \]
根据无穷小的定义得到
\[ \lim_{\Delta x \to 0} \frac{f(a + \Delta x) - f(a) - f'(a) \Delta x}{|\Delta x|} = 0 \]

\begin{definition}
	设 $n$ 元函数 $f(\vbf{x})$ 在 $\vbf{a}$ 的邻域内有定义，若存在 $n$ 维向量 $\vbf{b}$ 使得
	\[ \lim_{\Delta \vbf{x} \to 0} \frac{f(\vbf{a} + \Delta \vbf{x}) - f(\vbf{a}) - \vbf{b} \cdot \Delta \vbf{x}}{|\Delta \vbf{x}|} = 0 \]
	成立，即
	\[ f(\vbf{a} + \Delta \vbf{x}) - f(\vbf{a}) = \vbf{b} \cdot \Delta \vbf{x} + o(|\Delta x|) \]
	则称 $f$ 在 $\vbf{a}$ 处可微或可导，向量 $\vbf{b}$ 为函数 $f$ 在 $\vbf{a}$ 处的导数，记为
	\[ \vbf{b} = f'(\vbf{a}) = \nabla f(\vbf{a}) \]
	并记微分为 $\d f = \vbf{b} \cdot \d \vbf{x}$。
\end{definition}

假如考虑对于固定点 $\vbf{a}$，考虑在 $x_i$ 方向上的极限
\[ \lim_{\Delta x_i \to 0} \frac{f(a_1, \cdots, a_i + \Delta x_i, \cdots, a_n) - f(\vbf{a})}{\Delta x_i} \]
若极限存在，则称 $f$ 在 $\vbf{a}$ 关于 $x_i$ 可偏导，记极限为 $f$ 在 $\vbf{a}$ 处关于 $x_i$ 的偏导数并记为
\[ \frac{\partial f}{\partial x_i}(\vbf{a}) = f_{x_i}(\vbf{a}) \]

注意，偏导数存在不意味着可微。比如
\[ f(x, y) = \frac{xy}{x^2 + y^2}, \quad f(\vbf{0}) = 0 \]
此时 $f_x(\vbf{0}) = f_y(\vbf{0}) = 0$，但并不连续。

\begin{theorem}
	如果函数 $f$ 在 $\vbf{a}$ 处可微，则在 $\vbf{a}$ 处必存在偏导数且满足
	\[ f'(\vbf{a}) = \left( f_{x_1}(\vbf{a}), \cdots, f_{x_n}(\vbf{a}) \right) \]
	和
	\[ \d f(\vbf{a}) = f'(\vbf{a}) \d \vbf{x} = \sum_{i=1}^n f_{x_i} \d x_i \]
\end{theorem}

\begin{proof}
	由可微知存在 $\vbf{b}$ 使得
	\[ f(\vbf{a} + \Delta \vbf{x}) - f(\vbf{a}) = \vbf{b} \cdot \Delta \vbf{x} + o(|\Delta \vbf{x}|) \]
	此时我们可以取仅 $x_i$ 方向有值的无穷小，便可导出偏导。
\end{proof}

\begin{theorem}
	如果 $f$ 在 $\vbf{a}$ 的某个邻域存在偏导数，且偏导数在 $\vbf{a}$ 点连续，则 $f$ 在 $\vbf{a}$ 处可微。
\end{theorem}

考虑一单位向量 $\vbf{\mu}$，如果极限
\[ \frac{\partial f}{\partial \mu}(\vbf{x}_0) = \lim_{t \to 0+} \frac{f(\vbf{x}_0 + t \vbf{\mu}) - f(\vbf{x}_0)}{t} \]
存在，则称函数 $f$ 在 $\vbf{x}_0$ 处沿着方向 $\vbf{\mu}$ 是方向可导的，并称该极限为函数 $f$ 在 $\vbf{x}_0$ 处沿着 $\vbf{\mu}$ 的方向导数。

假如 $f$ 在 $\vbf{x}_0$ 处的偏导数存在，函数 $f$ 在 $\vbf{x}_0$ 处的梯度为
\[ \grad_{\vbf{x}_0} f = \nabla_{\vbf{x}_0} f = \left( f_{x_1}(\vbf{x}_0), \cdots, f_{x_n}(\vbf{x}_n) \right) \]
显然当函数 $f$ 可微时，$\nabla_{\vbf{x}_0} f = f'(\vbf{x}_0)$，且
\[ \frac{\partial f}{\partial \vbf{\mu}} (\vbf{x}_0) = \nabla_{\vbf{x}_0} f \cdot \vbf{\mu} \]

我们记其为 Nabla 算子，即
\[ \nabla = \left( \frac{\partial}{\partial x_1}, \cdots, \frac{\partial}{\partial x_n} \right) \]
和 Laplace 算子
\[ \Delta = \nabla \cdot \nabla = \sum_{i=1}^{n} \frac{\partial^2}{(\partial x_i)^2} \]
如果函数 $f$ 的所有二阶偏导存在且 $\Delta f = 0$，则称其为调和的。

推广偏导数概念到二阶直至更高阶是自然的，但是微分算子是不可交换的。

\begin{theorem}[Clairaut - Euler]
	假设函数 $f$ 的混合二阶偏导数 $f_{x_i x_j}$ 和 $f_{x_j x_i}$ 在 $\vbf{x}_0$ 连续，则必有 $f_{x_i x_j}(\vbf{x}_0) = f_{x_j x_i}(\vbf{x}_0)$。
\end{theorem}

\section{偏导数的应用}

\subsection{链式法则}

我们以二元为例子，考虑二元二维向量值函数 $\vbf{g}(x, y) = (u(x, y), v(x, y))$，得到复合函数
\[ z = (f \circ \vbf{g})(x, y) = f(u(x, y), v(x, y)) \]
我们有链式法则
\[ \begin{aligned}
		\frac{\partial z}{\partial x}(x_0, y_0) = \frac{\partial f}{\partial u}(u_0, v_0) \frac{\partial u}{\partial x}(x_0, y_0) + \frac{\partial f}{\partial v}(u_0, v_0)\frac{\partial v}{\partial x}(x_0, y_0) \\
		\frac{\partial z}{\partial y}(x_0, y_0) = \frac{\partial f}{\partial u}(u_0, v_0) \frac{\partial u}{\partial y}(x_0, y_0) + \frac{\partial f}{\partial v}(u_0, v_0)\frac{\partial v}{\partial y}(x_0, y_0)
	\end{aligned} \]

\subsection{微分中值定理}

如果对任意 $\vbf{x}_0, \vbf{x}_1 \in D$ 都有
\[ \overline{\vbf{x}_0 \vbf{x}_1} = \{ (1-t)\vbf{x}_0 + t\vbf{x}_1 \mid t \in (0, 1) \} \subset D \]
则称区域 $D \subset \mathbb{R}^n$ 是凸的。如果对 $\vbf{x}_0$ 有任意的 $\vbf{x}_1$ 都有 $\overline{\vbf{x}_0 \vbf{x}_1} \subset D$，称 $D \subset \mathbb{R}^n$ 是关于 $\vbf{x}_0$ 星形的。

\begin{theorem}
	若多元函数 $f$ 在凸区域 $D \subset \mathbb{R}^n$ 内可微，则对 $D$ 内的任意两点 $\vbf{x}_0$ 和 $\vbf{x}$，存在 $\theta \in (0, 1)$ 使得
	\[ f(\vbf{x}) - f(\vbf{x}_0) = \nabla_{\vbf{x}_0 + \theta(\vbf{x} - \vbf{x}_0)}(f) \cdot (\vbf{x} - \vbf{x}_0) \]
\end{theorem}

类似的，我们可以把一元的 Taylor 各种公式扩展到多元。

\subsection{切线与法平面}

考虑空间中曲线的参数方程
\[ \vbf{r}(t) = (x(t), y(t), z(t)), \quad t \in [a, b] \]
如果 $\vbf{r}'(t)$ 连续且 $\vbf{r}'(t) \neq \vbf{0}$ 则称曲线是光滑的。

固定点 $\vbf{P}_0 = (x_0, y_0, z_0)$，我们可以得到切向量
\[ \vbf{r}'(t_0) = (x'(t_0), y'(t_0), z'(t_0)) \]
和曲线在 $\vbf{P}_0$ 处的切线方程
\[ \frac{x - x_0}{x'(t_0)} = \frac{y - y_0}{y'(t_0)} = \frac{z - z_0}{z'(t_0)} \]
和曲线在 $\vbf{P}_0$ 处的法平面
\[ x'(t_0)(x - x_0) + y'(t_0)(y - y_0) + z'(t_0)(z - z_0) = \vbf{r}'(t_0) \cdot (\vbf{p} - \vbf{P}_0) = 0 \]

考虑曲面的方程
\[ F(x, y, z) = 0 \]
固定点 $\vbf{P}_0 = (x_0, y_0, z_0)$，得到切平面的法向量
\[ \vbf{n} = (F_x(\vbf{P}_0), F_y(\vbf{P}_0), F_z(\vbf{P}_0)) \]
从而得到切平面方程为
\[ F_x(\vbf{P}_0)(x-x_0) + F_y(\vbf{P}_0)(y-y_0) + F_z(\vbf{P}_0)(z-z_0) = \nabla_{\vbf{P}_0}f \cdot (\vbf{p} - \vbf{P}_0) = 0 \]
和法线方程
\[ \frac{x - x_0}{F_x(t_0)} = \frac{y - y_0}{F_y(t_0)} = \frac{z - z_0}{F_z(t_0)} \]

\section{极值问题}

极值问题主要有两种：无条件极值和有条件极值。

对于多元函数 $f$，若存在 $\vbf{x}_0$ 的邻域 $\mathbb{B}^n(\vbf{x}_0, \rho)$ 使得
\[ f(\vbf{x}_0) \geqslant f(\vbf{x}) \]
则称 $\vbf{x}_0$ 为 $f$ 的极大值点。类似的，有极小值点，统称为极值点。如果存在去心邻域 $\mathbb{B}^n(\vbf{x}_0, \rho) - \{\vbf{x}_0\}$ 使得
\[ f(\vbf{x}_0) > f(\vbf{x}) \]
则称为严格极大值点。类似的有严格极小值和严格极值点。

\subsection{无条件极值}

\begin{theorem}[多元函数 Fermat 引理]
	假设 $n$ 元函数 $f$ 在 $\vbf{x}_0$ 处可偏导且 $\vbf{x}_0$ 为其极值点，则 $f'(\vbf{x}_0) = \vbf{0}$。
\end{theorem}

\begin{theorem}
	假设 $\vbf{x}_0$ 为多元函数 $f$ 的驻点，并假设 $f$ 在 $\vbf{x}_0$ 处有二阶连续偏导数，引入 Hessian 矩阵
	\[ \operatorname{Hess}_{\vbf{x}}(f) = [f_{x_i x_j}(\vbf{x})]_{n \times n} \]
	则有如下结论：
	\begin{itemize}
		\item $\operatorname{Hess}_{\vbf{x}}(f)$ 正定，$f(\vbf{x}_0)$ 为严格极小值。
		\item $\operatorname{Hess}_{\vbf{x}}(f)$ 负定，$f(\vbf{x}_0)$ 为严格极大值。
		\item $\operatorname{Hess}_{\vbf{x}}(f)$ 不定，$f(\vbf{x}_0)$ 不是极值。
	\end{itemize}
\end{theorem}

那么对于二元函数 $f$，设 $(x_0, y_0)$ 为其驻点，引入记号
\[ \Delta(x_0, y_0) = (f_{xx} f_{yy} - f_{xy}^2)(x_0, y_0) \]
则有如下结论：
\begin{itemize}
	\item 如果 $\Delta > 0$ 且 $f_xx > 0$，为严格极小值。
	\item 如果 $\Delta > 0$ 且 $f_xx < 0$，为严格极大值。
	\item 如果 $\Delta < 0$，不是极值。
	\item 如果 $\Delta = 0$ 无法判断。
\end{itemize}

无法判断的例子有 $f_1 = x^2y^2, g = -f, h = x^2 y^3$，在 $0$ 处极值情况各不相同。

因此我们求取最值可以通过以下几个步骤：

\begin{itemize}
	\item 求出驻点和不可导点和相应的函数值。
	\item 求出边界上的函数值。
	\item 比较 $1$ 和 $2$ 的情况。
\end{itemize}

\subsection{条件极值问题}

Todo Lagrange 橙子法。

\section{二重积分}

\begin{definition}
	设 $D \subset \mathbb{R}^2$ 是渴求面积的有界点集，$z = f(x, y)$ 在 $D$ 上有界。任取分割 $\vbf{T}$ 把 $D$ 分成 $n$ 个不重不漏的可求面积的子区域 $D_i$，并记
	\[ \| \vbf{T} \| = \max_{i=1}^n \operatorname{diam}(D_i) \]
	在每个子区域 $D_i$ 上任取点 $(\xi_i, \eta_i)$ 并求和
	\[ \sigma(f, \vbf{T}, (\vbf{\xi}, \vbf{\eta})) = \sum_{i=1}^n f(\xi_i, \eta_i) |D_i| \]
	若当 $\|\vbf{T}\| \to 0$ 时，$\sigma(f, \vbf{T}, (\vbf{\xi}, \vbf{\eta}))$ 的极限存在且和分割 $\vbf{T}$ 及点 $(\xi_i, \eta_i)$ 的选取无关，则称函数 $f(x, y)$ 在 $D$ 上可积，并称该极限为函数 $f$ 在 $D$ 上的二重积分，记作
	\[ \iint_{D} f \d \sigma = \iint_{D} f(x, y) \d x \d y = \lim_{\| \vbf{T} \|} \sum_{i=1}^n \sigma(f, \vbf{T}, (\vbf{\xi}, \vbf{\eta})) \]
	我们称 $f$ 是可积函数，$D$ 是积分区域，$x, y$ 是积分变量，$\d \sigma = \d x \d y$ 是面积元。
\end{definition}

一般的，设 $\Omega \subset \mathbb{R}^n$ 是可测的闭区域，$f$ 是其上的有界函数，任取分割任取分割 $\vbf{T}$ 把 $\Omega$ 分成 $n$ 个不重不漏的可求面积的子区域 $\Omega_i$，并记
\[ \| \vbf{T} \| = \max_{i=1}^n \operatorname{diam}(\Omega_i) \]
在每个子区域 $\Omega_i$ 上任取点 $\vbf{\xi}_i$ 并求和
\[ V(f, \vbf{T}, \vbf{\xi}) = \sum_{i=1}^n f(\vbf{\xi}_i) |\Omega_i| \]
若当 $\|\vbf{T}\| \to 0$ 时，$V(f, \vbf{T}, \vbf{\xi})$ 的极限存在且和分割 $\vbf{T}$ 及点 $\vbf{\xi}_i$ 的选取无关，则称函数 $f$ 在 $\Omega$ 上可积，并称该极限为函数 $f$ 在 $\Omega$ 上的 $n$ 重积分，记作
\[ \iint_{\Omega} f \d V = \iint_{\Omega} f(\vbf{x}) \d \vbf{x} \d y = \int \cdots \int_{\Omega} f(x_1, \cdots, x_n) \d x_1 \cdots \d x_n \]
我们称 $f$ 是可积函数，$\Omega$ 是积分区域，$x, y$ 是积分变量，$\d V = \d x \d y$ 是面积元。

\begin{definition}[Fubini 定理]
	假设二元函数 $f$ 在闭矩形 $D = [a, b] \times [c, d]$，且对固定的 $x$，一元函数 $f(x, \cdot)$ 在 $[c, d]$ 上可积。若记
	\[ F(x) = \int_c^d f(x, y) \d y \]
	则 $F(x)$ 在 $[a, b]$ 上可积且
	\[ \iint_{D} f \d x \d y = \int_{a}^{b} F(x) \d x = \int_{a}^{b} \d x \int_{c}^{d} f \d x \d y \]
\end{definition}

一般的，我们对高维长方体和任意形状的 $D$，都可以转化 $n$ 重积分为逐次积分求解。

\subsection{曲面面积}

假设曲面为
\[ \Sigma : \vbf{r}(u, v) = (x(u, v), y(u, v), z(u, v)) \]
这里 $D$ 是具有光滑或分段光滑边界 $\partial D$ 的有界闭区域，$\vbf{r} : D \to \Sigma$ 是单的，且 Jacobi 矩阵是满秩的。

仿照几何直观性，对任意 $(u_0, v_0) \in D$ 且取充分小的 $\Delta u, \Delta v$，考虑四个点
\[ \begin{aligned}
		P_1 & = \vbf{r}(u_0, v_0) = \vbf{r}_0                                                  \\
		P_2 & = \vbf{r}(u_0 + \Delta u, v_0) \approx  \vbf{r}_0 + \vbf{r}_u(u_0, v_0) \Delta u \\
		P_3 & = \vbf{r}(u_0, v_0 + \Delta v) \approx \vbf{r}_0 + \vbf{r}_v(u_0, v_0) \Delta v  \\
		P_4 & = \vbf{r}(u_0 + \Delta u, v_0 + \Delta v)                                        \\
	\end{aligned} \]
则这四个点围城的面积
\[ \Delta S \approx \left| \overrightarrow{P_1P_2} \times \overrightarrow{P_2 P_4} \right| = |\vbf{r}_u \times \vbf{r}_v| (u_0, v_0) \Delta u \Delta v \]
故
\[ \d S = |\vbf{r}_u \times \vbf{r}_v| \d u \d v \]
因此光滑曲线的面积为
\[ \iint_D \d S = \iint_D |\vbf{r}_u \times \vbf{r}_v| \d u \d v \]

在以上条件下
\[ S = \iint_D \sqrt{EG - F^2} \d u \d v \]
其中
\[ \begin{aligned}
		E & = \vbf{r}_u \cdot \vbf{r}_u = x_u^2 + y_u^2 + z_u^2       \\
		F & = \vbf{r}_u \cdot \vbf{r}_v = x_u x_v + y_u y_v + z_u z_v \\
		G & = \vbf{r}_v \cdot \vbf{r}_v = x_v^2 + y_v^2 + z_v^2
	\end{aligned} \]
称为曲面的 Gauss 系数。

如果曲面的方程为 $z = f(x, y)$，不难带入得到
\[ E = 1 + f_x^2, \quad F = f_x f_y, \quad G = 1 + f_y^2 \]
故
\[ S = \iint_D \sqrt{1 + f_x^2 + f_y^2} \d x \d y = \iint_D \sqrt{1 + |\nabla(f)|^2} \d x \d y \]

\section{曲线和曲面积分}

\subsection{第一型曲线积分}

设 $L \subset R^3$ 是一条可求长的连续曲线，起点终点分别为 $A$ 和 $B$。$L$ 的分割 $\|T\|$ 是指 $L$ 上的有序有限点列
\[ A = P_0 \to P_1 \to \cdots P_n = B \]
令
\[ \Delta_s = \left| \widehat{P_{i-1}P_i} \right|, \quad \|T\| = \max_{i=1}^n \Delta s_i \]

\begin{definition}
	给定的 $f$ 是定义在 $L$ 上的有界函数。任取 $(\xi_i, \eta_i, \zeta_i) \in \widehat{P_{i-1} P_i}$ 并考虑有限和
	\[ S(f, \vbf{T}, (\vbf{\xi}, \vbf{\eta}, \vbf{\zeta})) = \sum_{i=1}^{n} f(\xi_i, \eta_i, \zeta_i)\Delta s_i \]
	如果 $\|\vbf{T}\| \to 0$ 时，$S(f, \vbf{T}, (\vbf{\xi}, \vbf{\eta}, \vbf{\zeta}))$ 存在极限且和分割 $\vbf{T}$ 及点 $(\xi_i, \eta_i, \zeta_i)$ 无关，称该极限
	\[ \int_L f \d s = \int_{L} f(x, y, z) \d s = \lim_{\|T\| \to 0} \sum_{i=1}^{n} f(\xi_i, \eta_i, \zeta_i) \Delta s_i \]
	为函数 $f$ 在曲线 $L$ 上的第一型曲线积分。此时称 $f$ 为被积函数而 $L$ 称为积分路径。
\end{definition}

假如 $L$ 以参数的形式给出
\[ \vbf{r}(t) = (x(t), y(t), z(t)) \]
且函数 $f$ 在 $L$ 上连续，则 $f$ 在 $L$ 上的第一型曲线积分存在且
\[ \int_L f \d s = \int_{\alpha}^{\beta}f(x(t), y(t), z(t)) \sqrt{x'(t)^2 + y'(t)^2 + z'(t)^2} \d t = \int_{\alpha}^\beta f(\vbf{r}(t))|\vbf{r}'(t)| \d t \]
特别的，如果 $\vbf{r}(x) = (x, y(x))$，则
\[ \int_L f \d s = \int_{a}^{b} f(x, y(x)) \sqrt{1 + y'^2} \d x \]

\subsection{第一型曲面积分}

假设 $\Sigma$ 是可求面积的连续曲面，分割 $\vbf{T}$ 是用坐标曲线网将 $\Sigma$ 分成的 $n$ 个小曲面。令
\[ \Delta S_i = |\Sigma_i|, \quad \|\vbf{T}\| = \max_{i=1}^n \Delta S_i \]

\begin{definition}
	给定的 $f$ 是定义在 $\Sigma$ 上的有界函数。任取 $(\xi_i, \eta_i, \zeta_i) \in \Sigma_i$ 并考虑有限和
	\[ S(f, \vbf{T}, (\vbf{\xi}, \vbf{\eta}, \vbf{\zeta})) = \sum_{i=1}^{n} f(\xi_i, \eta_i, \zeta_i)\Delta S_i \]
	如果 $\|\vbf{T}\| \to 0$ 时，$S(f, \vbf{T}, (\vbf{\xi}, \vbf{\eta}, \vbf{\zeta}))$ 存在极限且和分割 $\vbf{T}$ 及点 $(\xi_i, \eta_i, \zeta_i)$ 无关，称该极限
	\[ \iint_\Sigma f \d S = \iint_{\Sigma} f(x, y, z) \d S = \lim_{\|T\| \to 0} \sum_{i=1}^{n} f(\xi_i, \eta_i, \zeta_i) \Delta S_i \]
	为函数 $f$ 在曲线 $\Sigma$ 上的第一型曲面积分。此时称 $f$ 为被积函数而 $\Sigma$ 称为积分曲面。
\end{definition}

\subsection{第二型曲线积分}

假设 $L \subset \mathbb{R}^3$ 上定向的可求长的连续曲线，给定起点 $A$ 和终点 $B$。在每点上取单位切向量 $\vbf{\tau} = (\cos \alpha, \cos \beta, \cos \gamma)$，使得其与 $L$ 的定向一致。

\begin{definition}
	设 $\vbf{F} = (P, Q, R)$ 是一向量值函数，定义其沿着曲线 $L$ 的第二型曲线积分为
	\[ \int_L \vbf{F} \cdot \vbf{\tau} \d s = \int_L (P(x,y,z) \cos \alpha + Q(x, y, z) \cos \beta + R(x, y, z) \cos \gamma) \d s \]
	其中 $\d s$ 是 $L$ 的弧微元。定义弧微元向量
	\[ \d \vbf{s} = \vbf{\tau} \d s = (\d x, \d y, \d z) \]
	从而可以记成
	\[ \int_L \vbf{F} \cdot \d \vbf{s} = \int_L P \d x + Q \d y + R \d z \]
\end{definition}

其物理意义是力 $\vbf{F}$ 沿着曲线 $L$ 所做的功。

考虑向量形式
\[ \vbf{r}(t) = (x(t), y(t), z(t)) \]
其切向量为
\[ \vbf{\tau} = \frac{\vbf{r}'(t)}{|\vbf{r}'(t)|} \]
则
\[ \int_L P \d x + Q \d y + R \d z = \int_a^b \vbf{F}(\vbf{r}(t)) \cdot \vbf{r}'(t) \d t \]

\subsection{第二型曲面积分}

对于光滑曲面上任意一点 $P$，可以做两条方向相反的法线，假如对其上经过 $P$ 的闭合曲线，法线是连续变化且回到原位的，是定向曲面。比如 Mobius 带就不行。

设定向曲面由参数方程给出
\[ \vbf{r}(u, v) = (x(u, v), y(u, v), z(u, v)) \]
那么曲面的法向量可以表示为
\[ \pm \vbf{r}_u \times \vbf{r}_v = \pm \left( \frac{\partial(y, z)}{\partial (u, v)},\frac{\partial(z, x)}{\partial (u, v)},\frac{\partial(x, y)}{\partial (u, v)}  \right) \]
那么可以得到法向量
\[ \vbf{n} = \pm \frac{\vbf{r}_u \times \vbf{r}_v}{|\vbf{r}_u \times \vbf{r}_v|} \]
特别的，若 $z = z(x, y)$，则
\[ \vbf{n} = \pm \frac{1}{\sqrt{1 + z_x^2 + z_y^2}} (-z_x, z_y, 1) \]

\begin{definition}
	对于曲面 $\Sigma$ 和 $\vbf{n} = (\cos \alpha, \cos \beta, \cos \gamma)$，$\vbf{F} = (P, Q, R)$ 是其上的向量值函数
	\[ \iint_{\Sigma} \vbf{F} \cdot \vbf{n} \d S = \iint_{\Sigma} (P \cos \alpha + Q \cos \beta + R \cos \gamma) \d S \]
	定义面积微元向量
	\[ \d \vbf{S} = \vbf{n} \d S = (\d y \d z, \d z \d x, \d x \d y) \]
	从而可以记成
	\[ \iint_\Sigma \vbf{F} \cdot \d \vbf{S} = \iint_{\Sigma} P \d y \d z + Q \d z \d x + R \d x \d y \]
\end{definition}

\subsection{Green 公式}

考虑定向闭区间 $[a, b]$ 的边界 $\partial[a, b] = \{a, b\}$，我们可以定义其上的积分
\[ \int_{\partial[a, b]} f(x) = f(b) - f(a) \]
从而可以把一元函数 Newton - Leibniz 公式写为
\[ \int_{[a,b]} \d f(x) = \int_{[a, b]} f'(x) \d x = \int_{\partial [a, b]} f(x) \]
Green 公式就是考虑 Newton - Leibniz 公式的高维推广，由边界得出积分值。

曲线 $L \subset \mathbb{R}^2$，其曲线方程为 $\vbf{r}(t) = (x(t), y(t))$ 其中 $t \in [\alpha, \beta]$。如果 $\vbf{r}(\alpha) = \vbf{r}(\beta)$ 且 $\vbf{r}(t_1) \neq \vbf{r}(t_2)$ 对任何 $t_1 \neq t_2$ 都成立，则称曲线为 Jordan 曲线。

给定区域 $D \subset \mathbb{R}^2$，它的边界 $\partial \Omega$ 是平面曲线从而有两个方向。定义 $\partial D$ 的正向（诱导定向）如下：沿着 $\partial D$ 走一圈 $D$ 总是在左边。即右手定则。

\begin{theorem}[Green 公式]
	假设 $D \subset \mathbb{R}^2$ 是由有限条光滑或分段光滑的 Jordan 曲线所围成的区域，并取 $\partial D$ 的正向。对任何有一阶连续偏导数的 $P, Q$ 有
	\[ \int_{\partial D} P \d x + Q \d y = \iint_{D} \left( \frac{\partial Q}{\partial x} - \frac{\partial P}{\partial y} \right) \d x \d y = \iint_{D} \left| \begin{matrix}
			\frac{\partial}{\partial x} & \frac{\partial}{\partial y} \\
			P                           & Q
		\end{matrix} \right| \d x \d y \]
\end{theorem}

\begin{proof}
	假设区域是简单的可以按 $x,y$ 轴切片的，考虑区域
	\[ D_1 = \{ (x, y) \mid \varphi_1(y) \leqslant x \leqslant \psi_1 (y), c \leqslant y \leqslant d \} \]
	计算得到
	\[ \begin{aligned}
			\int_{\partial D} Q \d y & = \int_{c}^d Q(\psi_1(y), y) \d y - \int_c^d Q(\varphi_1(y), y) \d y               \\
			                         & = \int_c^d \d y \int_{\varphi_1(y)}^{\psi_1(y)} \frac{\partial Q}{\partial x} \d x \\
			                         & = \iint_{D} \frac{\partial Q}{\partial x} \d x \d y
		\end{aligned} \]
	同理，我们对另一侧划分
	\[ D_2 = \{ (x, y) \mid \varphi_2(x) \leqslant y \leqslant \psi_2 (x), a \leqslant x \leqslant b \} \]
	可以得到
	\[ \int_{\partial D} P \d x = -\iint_{D} \frac{\partial P}{\partial y} \d x \d y \]
	对于一般的区域，我们可以分割成多个可以切片的区域，综合即证。
\end{proof}

假如重积分区域存在奇点呢？我们可以绕一圈。

% https://github.com/yuxtech/ShiJihuai-complex/blob/master/chap5.tex#L1099
\begin{figure}[!ht]
	\centering
	\begin{tikzpicture}[thick,every node/.style={inner sep=2pt},
		>={Stealth[width=3pt]}]
		\draw(4:0.8)node[above right]{$\rho$}--++(2.215,0)node[above right]{$R$}--++(-2.229,0)
		(3:0.8)arc(3:356:0.8)--++(2.215,0);
		\draw(1:3)arc(1:358.7:3);
		\draw[->,very thin](30:3)arc(30:110:3);
		\draw[->,very thin](0,-0.8)--++(-0.1,0);
		\draw(140:1)node{$\gamma_\rho$}(70:3.2)node{$\gamma_R$};
		\fill(0,0)circle(1pt)node[below]{$O$};
	\end{tikzpicture}
	\caption{\label{fig8.1}}
\end{figure}

\begin{theorem}[Green 定理]
	假设 $D \subset \mathbb{R}^2$ 是区域且 $P, Q$ 在 $D$ 上连续，则下列命题等价：

	\begin{itemize}
		\item 对 $D$ 内任意分段光滑曲线 $L$，曲线积分
		      \[ \int_L P \d x + Q \d y \]
		      与路径 $L$ 无关，只与 $L$ 的起点和终点有关。
		\item 如果存在 $U$ 使得 $\d U = P \d x + Q \d y$，即称 $P \d x + Q \d y$ 在 $D$ 上是正合的，称 $U$ 是其原函数。
		\item 沿着 $D$ 内任意分段光滑闭曲线 $L$，有
		      \[ \oint_{L} P \d x + Q \d y = 0 \]
	\end{itemize}
\end{theorem}

如果进一步假设 $P, Q$ 在 $D$ 上一阶导数连续，则在 $D$ 内处处成立
\[ \frac{\partial Q}{\partial x} = \frac{\partial P}{\partial y} \]
且和上面三条等价。

\subsection{Gauss 公式}

\begin{theorem}[Gauss 公式]
	设 $\Omega \subset \mathbb{R}^3$ 是区域且边界 $\partial \Omega$ 是由分段光滑的定向曲面构成。设 $P, Q, R$ 是一阶导数连续的，则
	\[ \iint_{\partial \Omega} P \d y \d z + Q \d z \d x + R \d x \d y = \iiint_{\Omega} \left( \frac{\partial P}{\partial x} + \frac{\partial Q}{\partial y} + \frac{\partial R}{\partial z} \right) \d x \d y \d z \]
\end{theorem}

\subsection{Stokes 公式}

\begin{theorem}[Stokes 公式]
	设 $\Sigma$ 是光滑定向曲面且边界 $\partial \Sigma$ 为分段光滑闭曲面，取诱导定向。对其上具有一阶连续偏导数的函数 $P, Q, R$ 有
	\[ \int_{\partial \Sigma} P \d x + Q \d y + R \d z = \iint_\Sigma \left| \begin{matrix}
			\d y \d z                   & \d z \d x                   & \d x \d y                   \\
			\frac{\partial}{\partial x} & \frac{\partial}{\partial y} & \frac{\partial}{\partial z} \\
			P                           & Q                           & R
		\end{matrix} \right| \]
\end{theorem}

\section{旋转体}

假设平面曲线 $y = f(x)$ 绕 $x$ 轴进行旋转，则旋转体体积为
\[ V = \pi \int_a^b f^2(x) \d x \]
假如曲线以 $y = \tan x$ 进行旋转，则
\[ V = \pi \int_a^b |x \cos \theta - y \sin \theta|^2(\cos \theta \d x + \sin \theta \d y) = \pi \int_a^b \frac{|yk-x|^2}{(k^2+1)^{\frac{3}{2}}}(y'k+1) \d x \]


